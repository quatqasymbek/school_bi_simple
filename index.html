<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–®–∫–æ–ª—å–Ω–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (BI)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --primary: #123b71; --bg: #f4f7f6; --card-bg: #ffffff; --text: #333; --border: #dde2e5; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--primary); color: #fff; padding: 0 20px; height: 60px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
        header h1 { font-size: 1.2rem; margin: 0; font-weight: 600; }
        .tabs-bar { background: #1c4e8f; display: flex; overflow-x: auto; flex-shrink: 0; }
        .tab-link { padding: 12px 20px; color: #b0c4de; text-decoration: none; font-size: 0.9rem; border-bottom: 3px solid transparent; cursor: pointer; white-space: nowrap; }
        .tab-link.active { color: #fff; border-bottom-color: #fff; font-weight: 500; }
        main { flex: 1; overflow-y: auto; padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--card-bg); border-radius: 8px; padding: 20px; border: 1px solid var(--border); margin-bottom: 20px; }
        .card h3 { margin-top: 0; font-size: 1rem; color: #555; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .controls-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        select, button { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; }
        button:hover { background: #0e2a50; }
        .kpi-value { font-size: 2.5rem; font-weight: 700; color: var(--primary); }
        .kpi-label { font-size: 0.9rem; color: #777; margin-top: 5px; }
        .ai-box { background: #eef2f6; border-left: 4px solid var(--primary); padding: 15px; margin-top: 15px; min-height: 60px; }
        .table-responsive { overflow-x: auto; }
        table.data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        table.data-table th, table.data-table td { padding: 10px 15px; text-align: center; border-bottom: 1px solid #eee; }
        table.data-table th { background: #f9f9f9; font-weight: 600; color: #555; text-align: left; }
        #statusBar { font-size: 12px; color: #888; margin-left: 15px; }
        .upload-btn { background: #27ae60; padding: 10px 20px; border-radius: 4px; cursor: pointer; color:#fff; text-decoration:none; }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        <span>üìä –®–∫–æ–ª—å–Ω–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
    </div>
    <div style="display:flex; align-items:center; gap:15px;">
        <label class="upload-btn" for="excelUpload">–ó–∞–≥—Ä—É–∑–∏—Ç—å Excel</label>
        <input type="file" id="excelUpload" accept=".xlsx,.xls" />
        <span id="statusBar">–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ</span>
    </div>
</header>

<div class="tabs-bar">
    <div class="tab-link active" data-page="overview">–û–±–∑–æ—Ä</div>
    <div class="tab-link" data-page="classes">–ö–ª–∞—Å—Å—ã</div>
    <div class="tab-link" data-page="subjects">–ü—Ä–µ–¥–º–µ—Ç—ã</div>
    <div class="tab-link" data-page="teachers">–£—á–∏—Ç–µ–ª—è</div>
    <div class="tab-link" data-page="attendance">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
    <div class="tab-link" data-page="students">–£—á–µ–Ω–∏–∫–∏</div>
</div>

<main>
    <!-- –û–±–∑–æ—Ä -->
    <div id="overview" class="page active">
        <div class="controls-row">
            <div><label>–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="ovTermSelect"></select></div>
            <div><label>–ú–µ—Ç—Ä–∏–∫–∞:</label><select id="ovMetricSelect">
                <option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π (%)</option>
                <option value="average">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ (1-5)</option>
            </select></div>
            <div style="margin-left:auto;"><button id="btn-overview-refresh">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
        </div>
        <div class="grid-2">
            <div class="card" style="text-align:center;"><div class="kpi-value" id="ovKpiStudents">-</div><div class="kpi-label">–í—Å–µ–≥–æ —É—á–∞—â–∏—Ö—Å—è</div></div>
            <div class="card" style="text-align:center;"><div class="kpi-value" id="ovKpiTeachers">-</div><div class="kpi-label">–í—Å–µ–≥–æ —É—á–∏—Ç–µ–ª–µ–π</div></div>
        </div>
        <div class="grid-2">
            <div class="card"><h3>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</h3><div id="chart-overview-donut" style="height:350px;"></div></div>
            <div class="card"><h3>–ü–æ –ø–∞—Ä–∞–ª–ª–µ–ª—è–º</h3><div id="chart-overview-grades" style="height:350px;"></div></div>
        </div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>üß† AI –ê–Ω–∞–ª–∏—Ç–∏–∫</h3>
                <button id="btn-overview-ai">–û–±—ä—è—Å–Ω–∏—Ç—å —Ç—Ä–µ–Ω–¥</button>
            </div>
            <div id="overview-ai-output" class="ai-box">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</div>
        </div>
    </div>

    <!-- –ö–ª–∞—Å—Å—ã --><div id="classes" class="page"><div class="card"><h3>–ü–æ –∫–ª–∞—Å—Å–∞–º</h3><div id="chart-class-avg" class="table-responsive"></div></div><div class="card"><div class="controls-row"><label>–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="classTermSelect"></select><label style="margin-left:15px;">–ö–ª–∞—Å—Å:</label><select id="classClassSelect"></select></div><div id="chart-class-dist" style="height:400px;"></div></div></div>
    <!-- –ü—Ä–µ–¥–º–µ—Ç—ã --><div id="subjects" class="page"><div class="card"><div class="controls-row"><label>–ü—Ä–µ–¥–º–µ—Ç:</label><select id="subjectSubjectSelect"></select><label style="margin-left:15px;">–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="subjectTermSelect"></select></div><div class="grid-2"><div id="chart-subject-class" style="height:350px;"></div><div id="chart-subject-dist" style="height:350px;"></div></div><div class="grid-2" style="margin-top:20px;"><div id="chart-subject-trend" style="height:350px;"></div><div id="chart-subject-heatmap" style="height:350px;"></div></div></div></div>
    <!-- –£—á–∏—Ç–µ–ª—è --><div id="teachers" class="page"><div class="card"><div class="controls-row"><label>–£—á–∏—Ç–µ–ª—å:</label><select id="teacherSelect"></select><label style="margin-left:15px;">–ü—Ä–µ–¥–º–µ—Ç:</label><select id="teacherSubjectSelect"></select></div><div class="grid-2"><div id="chart-teacher-performance" style="height:400px;"></div><div id="chart-teacher-subjects" style="height:400px;"></div></div><div style="margin-top:20px;"><div id="chart-teacher-trend" style="height:350px;"></div></div></div></div>
    <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å --><div id="attendance" class="page"><div class="card"><h3>–°–≤–æ–¥–∫–∞</h3><div class="controls-row"><label>–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="attTermSummary"></select></div><div id="attSummaryTableWrapper" class="table-responsive"></div></div><div class="card"><h3>–ü–æ —É—á–µ–Ω–∏–∫–∞–º</h3><div class="controls-row"><label>–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="attTermDetail"></select><label style="margin-left:15px;">–ö–ª–∞—Å—Å:</label><select id="attClassDetail"></select></div><div id="attDetailTableWrapper" class="table-responsive"></div></div></div>
    <!-- –£—á–µ–Ω–∏–∫–∏ --><div id="students" class="page"><div class="card"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;"><h3>–ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ü–µ–Ω–∫–∏ —É—á–µ–Ω–∏–∫–æ–≤</h3><div class="controls-row"><label>–ö–ª–∞—Å—Å:</label><select id="studClassSelect"></select><label style="margin-left:15px;">–ß–µ—Ç–≤–µ—Ä—Ç—å:</label><select id="studTermSelect"></select></div></div><div class="table-responsive"><div id="studentsTableWrapper"><p style="padding:30px;text-align:center;color:#999;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏ —á–µ—Ç–≤–µ—Ä—Ç—å</p></div></div></div></div>
</main>

<!-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

<script src="utils.js"></script>
<script src="main.js"></script>  <!-- –ó–¥–µ—Å—å —Å–æ–∑–¥–∞—ë—Ç—Å—è window.SBI -->
<script src="llm_cpu.js"></script>

<!-- –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—Å–µ –¥–∞—à–±–æ—Ä–¥—ã ‚Äî SBI —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç -->
<script src="overview.js"></script>
<script src="overview_ai.js"></script>
<script src="attendance.js"></script>
<script src="dashboard_class.js"></script>
<script src="dashboard_subject.js"></script>
<script src="dashboard_teacher.js"></script>
<script src="dashboard_students.js"></script>

<script>
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.addEventListener('DOMContentLoaded', () => {
        const links = document.querySelectorAll('.tab-link');
        const pages = document.querySelectorAll('.page');
        function show(pageId) {
            pages.forEach(p => p.classList.remove('active'));
            const page = document.getElementById(pageId);
            if (page) page.classList.add('active');
            links.forEach(l => l.classList.remove('active'));
            const link = document.querySelector(`.tab-link[data-page="${pageId}"]`);
            if (link) link.classList.add('active');
            setTimeout(() => Plotly?.Plots?.resize && document.querySelectorAll('.js-plotly-plot').forEach(Plotly.Plots.resize), 100);
        }
        links.forEach(l => l.addEventListener('click', () => show(l.dataset.page)));
        show('overview');
    });
</script>
</body>
</html>
