<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–®–∫–æ–ª—å–Ω–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (BI)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

    <style>
        /* RESET & BASE */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --white: #ffffff;
            --text: #333;
            --border: #ddd;
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        header {
            background: var(--primary);
            color: var(--white);
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 1.4rem; font-weight: 600; margin: 0; }
        
        /* CONTROLS (Hardcoded Upload Button) */
        .header-controls { display: flex; gap: 10px; }
        .btn-upload {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        .btn-upload:hover { background: rgba(255,255,255,0.3); }

        /* NAVIGATION */
        .tabs {
            background: var(--white);
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 5px;
            flex-shrink: 0;
            overflow-x: auto;
        }
        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1rem;
            color: #666;
            cursor: pointer;
            white-space: nowrap;
        }
        .tab-btn:hover { background: #f9f9f9; color: var(--primary); }
        .tab-btn.active { border-bottom-color: var(--accent); color: var(--accent); font-weight: 600; }

        /* MAIN CONTENT */
        main { flex: 1; overflow-y: auto; padding: 20px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* UI COMPONENTS */
        .card { background: var(--white); border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 1.3rem; color: var(--primary); }
        h3 { font-size: 1.1rem; color: #555; margin-bottom: 15px; }

        .filters { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 6px; }
        select, button.action-btn { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; }
        button.action-btn { background: var(--accent); color: white; border: none; cursor: pointer; }
        button.action-btn:hover { opacity: 0.9; }

        /* KPIS */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .kpi-box { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .kpi-val { font-size: 2rem; font-weight: bold; color: var(--accent); }
        .kpi-lbl { font-size: 0.9rem; color: #777; text-transform: uppercase; margin-top: 5px; }

        /* TABLES */
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th, td { padding: 10px; border: 1px solid #eee; text-align: center; }
        th { background: #f4f4f4; font-weight: 600; color: #333; }
        td { color: #555; }
        
        /* UTILS */
        .hidden-input { display: none; }
        .status-good { color: #27ae60; font-weight: bold; }
        .status-bad { color: #c0392b; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <h1>üìä –®–∫–æ–ª—å–Ω–∞—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</h1>
        <div class="header-controls">
            <!-- HARDCODED BUTTON - WILL NOT DISAPPEAR -->
            <button class="btn-upload" onclick="document.getElementById('fileLoader').click()">
                üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel/CSV
            </button>
            <input type="file" id="fileLoader" class="hidden-input" multiple accept=".csv,.xlsx">
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" data-target="page-overview">–û–±–∑–æ—Ä</button>
        <button class="tab-btn" data-target="page-classes">–ö–ª–∞—Å—Å—ã</button>
        <button class="tab-btn" data-target="page-students">–£—á–µ–Ω–∏–∫–∏</button>
        <button class="tab-btn" data-target="page-teachers">–£—á–∏—Ç–µ–ª—è</button>
        <button class="tab-btn" data-target="page-subjects">–ü—Ä–µ–¥–º–µ—Ç—ã</button>
        <button class="tab-btn" data-target="page-attendance">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
    </div>

    <main>
        <!-- PAGE: OVERVIEW -->
        <div id="page-overview" class="page active">
            <div class="filters">
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="ovTerm"></select></label>
                <label>–ú–µ—Ç—Ä–∏–∫–∞: <select id="ovMetric"><option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</option><option value="avg">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</option></select></label>
            </div>
            
            <div class="kpi-grid">
                <div class="kpi-box"><div class="kpi-val" id="kpi-total-students">0</div><div class="kpi-lbl">–£—á–µ–Ω–∏–∫–æ–≤</div></div>
                <div class="kpi-box"><div class="kpi-val" id="kpi-total-teachers">0</div><div class="kpi-lbl">–£—á–∏—Ç–µ–ª–µ–π</div></div>
                <div class="kpi-box"><div class="kpi-val" id="kpi-metric-val">-</div><div class="kpi-lbl">–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —à–∫–æ–ª—ã</div></div>
            </div>

            <div class="card">
                <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                    <div style="flex: 2; min-width: 300px;">
                        <h3>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –ø–∞—Ä–∞–ª–ª–µ–ª—è–º (1-11)</h3>
                        <div class="table-wrap" id="ovGradeTable"></div>
                    </div>
                    <div style="flex: 1; min-width: 300px;">
                        <h3>–°—Ç–∞—Ç—É—Å —É—á–∞—â–∏—Ö—Å—è</h3>
                        <div id="ovDonut" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>ü§ñ –ò–ò-–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h2>
                <button class="action-btn" id="aiBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑</button>
                <div id="aiOutput" style="margin-top:15px; padding:15px; background:#f0f7ff; border-radius:4px; min-height:50px; color:#444;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...</div>
            </div>
        </div>

        <!-- PAGE: CLASSES -->
        <div id="page-classes" class="page">
            <div class="filters">
                <label>–ú–µ—Ç—Ä–∏–∫–∞: <select id="clMetric"><option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</option><option value="avg">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</option></select></label>
            </div>
            <div class="card">
                <h2>–†–µ–π—Ç–∏–Ω–≥ –∫–ª–∞—Å—Å–æ–≤</h2>
                <div class="table-wrap" id="clTable"></div>
            </div>
            <div class="filters">
                <label>–ö–ª–∞—Å—Å: <select id="clSelect"></select></label>
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="clTerm"></select></label>
            </div>
            <div class="card">
                <h3>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞</h3>
                <div id="clDonut" style="height: 350px;"></div>
            </div>
        </div>

        <!-- PAGE: STUDENTS -->
        <div id="page-students" class="page">
            <div class="filters">
                <label>–ö–ª–∞—Å—Å: <select id="stClass"></select></label>
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="stTerm"></select></label>
                <button class="action-btn" id="stLoadBtn">–ü–æ–∫–∞–∑–∞—Ç—å</button>
            </div>
            <div class="card">
                <h2>–í–µ–¥–æ–º–æ—Å—Ç—å —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h2>
                <div class="table-wrap" id="stTable"></div>
            </div>
        </div>

        <!-- PAGE: TEACHERS -->
        <div id="page-teachers" class="page">
             <div class="filters">
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="tcTerm"></select></label>
                <label>–ú–µ—Ç—Ä–∏–∫–∞: <select id="tcMetric"><option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</option><option value="avg">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</option></select></label>
            </div>
            <div class="card" style="display:flex; gap:20px;">
                <div style="flex:1;">
                    <h3>–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ–¥–∞–≥–æ–≥–æ–≤</h3>
                    <div id="tcQualDonut" style="height:300px;"></div>
                </div>
                <div style="flex:1;">
                    <h3>–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —É —É—á–∏—Ç–µ–ª—è</h3>
                    <select id="tcTeacherSel" style="width:100%; margin-bottom:10px;"></select>
                    <div id="tcIndDonut" style="height:260px;"></div>
                </div>
            </div>
            <div class="card">
                <h2>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—á–∏—Ç–µ–ª–µ–π</h2>
                <div class="table-wrap" id="tcTable"></div>
            </div>
        </div>

        <!-- PAGE: SUBJECTS -->
        <div id="page-subjects" class="page">
            <div class="filters">
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="sbTerm"></select></label>
                <label>–ú–µ—Ç—Ä–∏–∫–∞: <select id="sbMetric"><option value="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π</option><option value="avg">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</option></select></label>
            </div>
            <div class="card">
                <h2>–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h2>
                <div id="sbChart" style="height: 400px;"></div>
            </div>
            <div class="card">
                <h2>–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–ü—Ä–µ–¥–º–µ—Ç—ã vs –ö–ª–∞—Å—Å—ã)</h2>
                <div id="sbHeatmap" style="height: 500px;"></div>
            </div>
        </div>

        <!-- PAGE: ATTENDANCE -->
        <div id="page-attendance" class="page">
            <div class="filters">
                <label>–ß–µ—Ç–≤–µ—Ä—Ç—å: <select id="atTerm"></select></label>
            </div>
            <div class="card">
                <h2>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –ø–æ –∫–ª–∞—Å—Å–∞–º</h2>
                <div class="table-wrap" id="atClassTable"></div>
            </div>
            <div class="filters">
                <label>–ö–ª–∞—Å—Å: <select id="atClassSel"></select></label>
            </div>
            <div class="card">
                <h2>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É—á–µ–Ω–∏–∫–∞–º</h2>
                <div class="table-wrap" id="atStudentTable"></div>
            </div>
        </div>

    </main>

    <!-- Logic Scripts -->
    <script src="main.js"></script>
    <script src="dashboard_overview.js"></script>
    <script src="dashboard_class.js"></script>
    <script src="dashboard_student.js"></script>
    <script src="dashboard_teacher.js"></script>
    <script src="dashboard_subject.js"></script>
    <script src="attendance.js"></script>
    <script src="llm_cpu.js"></script>

    <script>
        // Simple Tab Logic
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.target).classList.add('active');
            });
        });
    </script>
</body>
</html>
